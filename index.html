// Thêm đoạn code này vào phần script của form, thay thế phần script cũ
<script>
    function toggleContactField(fieldName) {
        const field = document.getElementById(fieldName + 'Field');
        const checkbox = document.getElementById(fieldName);
        if (checkbox.checked) {
            field.style.display = 'block';
        } else {
            field.style.display = 'none';
            const input = field.querySelector('input');
            if (input) input.value = '';
        }
    }

    document.getElementById('consultationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const checkedMethods = document.querySelectorAll('input[name="contact_method"]:checked');
        if (checkedMethods.length === 0) {
            alert('Vui lòng chọn ít nhất một phương thức liên hệ');
            return;
        }

        let isValid = true;
        checkedMethods.forEach(method => {
            const fieldId = method.id + 'Field';
            const input = document.querySelector(`#${fieldId} input`);
            if (!input.value.trim()) {
                isValid = false;
                input.style.borderColor = 'red';
            }
        });

        if (!isValid) {
            alert('Vui lòng điền đầy đủ thông tin cho các phương thức liên hệ đã chọn');
            return;
        }

        // Hiển thị loading
        document.getElementById('loading').style.display = 'block';

        // Tạo object chứa dữ liệu form
        const formData = {
            'Họ và tên': this.querySelector('[name="Họ và tên"]').value,
            'Nơi ở hiện tại': this.querySelector('[name="Nơi ở hiện tại"]').value,
            'Dịch vụ làm đẹp': this.querySelector('[name="Dịch vụ làm đẹp"]').value,
            'Số điện thoại': document.getElementById('phone').checked ? this.querySelector('[name="Số điện thoại"]').value : '',
            'Zalo': document.getElementById('zalo').checked ? this.querySelector('[name="Zalo"]').value : '',
            'LINE': document.getElementById('line').checked ? this.querySelector('[name="LINE"]').value : '',
            'Viber': document.getElementById('viber').checked ? this.querySelector('[name="Viber"]').value : '',
            'WhatsApp': document.getElementById('whatsapp').checked ? this.querySelector('[name="WhatsApp"]').value : ''
        };

        // Gửi dữ liệu đến Google Apps Script
        fetch('https://script.google.com/macros/s/AKfycbwjGdLP43xK-pDuRscxBluv6CuGtgj1FRg1K-9oyFWcJ1jgVOWsStylmOcW1XS2_Lon7g/exec', {
            method: 'POST',
            body: JSON.stringify(formData),
            mode: 'no-cors'
        })
        .then(response => {
            document.getElementById('loading').style.display = 'none';
            window.location.href = 'thanks.html';
        })
        .catch(error => {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            console.error('Error!', error);
        });
    });
</script>
